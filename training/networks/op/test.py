import jittor as jt
import os

if jt.compiler.has_cuda:
    jt.flags.use_cuda = 1

module_path = os.path.dirname(__file__)
src = os.path.join(module_path, "upfirdn2d_op.cc")
header = os.path.join(module_path, "upfirdn2d_op.h")
upfirdn2d_op = jt.compile_custom_ops((src, header))

input = jt.Var( [[[[-2.63783813e-01, -1.92756146e-01, -4.76301312e-01, -4.68687475e-01,
    -1.63082659e-01, -2.21958026e-01],
   [-9.42788422e-02, -1.72926746e-02, 1.09157488e-01, 3.97438817e-02,
    -2.64914352e-02, 1.07887365e-01],
   [-3.69531035e-01, -2.37874806e-01, -5.22538543e-01, -2.75375545e-01,
    -2.49189630e-01, -4.93587293e-02],
   [-6.65548220e-02, -2.64864802e-01, -2.40067929e-01, -1.32842451e-01,
     1.10274695e-01, -1.05702341e-01],
   [-9.50481817e-02, -2.93047503e-02, 4.03917581e-03, 1.56701058e-02,
     1.17928423e-01, 3.52717973e-02],
   [-4.49919067e-02, -8.43551382e-02, 3.22211832e-02, -9.29862112e-02,
    -5.73342294e-02, -6.26771227e-02]]]],)

kernel = jt.Var([[0.0625,0.1875,0.1875,0.0625],
 [0.1875,0.5625,0.5625,0.1875],
 [0.1875,0.5625,0.5625,0.1875],
 [0.0625,0.1875,0.1875,0.0625]],)
up = (1, 1)
down = (1, 1)
pad = (1, 1, 1, 1)
out = upfirdn2d_op.upfirdn2d(input, kernel, up[0],up[1],down[0],down[1], pad[0], pad[1],pad[2],pad[3]).fetch_sync()
print(out)